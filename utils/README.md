# **Модуль «utils/»**
*«Модуль, реализующий методы детекции, логирования и unit-тестирования»*

Модуль включает в себя следующие компоненты:
- ```detector.py``` – реализация детекции объекта
- ```logger.py``` – система логирования
- ```tester.py``` – система unit–тестирования

Далее каждый из компонентов рассматривается детальнее.

# detector.py
*«Детекция фрагмента»*

Функция компонента использует SIFT детектор для определения ключевых точек и дескрипторов объекта и изображения. Дальнейший мэтчинг дескрипторов производится при помощи набора FLANN алгоритмов по принципу поиска k ближайших соседей (на текущий момент FLANN реализация является самой оптимальной, а k=2 – более чем достаточным). Очистка итоговых мэтчей осуществляется при помощи порогового отношения Lowe с коэффициентом 0.7, а проекция мэтчей – при помощи встроенного в OpenCV механизма гомографии. Углы и смещения объекта на изображении определятся планиметрически при помощи координат проекции, построенной на предыдущем шаге.

```python
@logger ### декоратор системы логирования
def detector(
    query_path:str,
    train_path:str,
    params:dict=PARAMS, ### глобально предопределенный набор параметров
    logfile:bool=True,
    log:object=None,
    attempt:int=1,
    **kwargs ### экстра параметры
) -> None:
    ...
```

Функция принимает следующие параметры:
- ```query_path:str``` – путь к эталонному изображению (объекту)
- ```train_path:str``` – путь к исследуемому изображению (изображению)
- ```params:dict``` – конфигурационный словарь с рядом тюнинг параметров:
  - ```MIN_MATCHES:int``` – минимально необходимое количество мэтчей для определения местоположения объекта на изображении и обработки исключений,
  - ```FLN_INDEX:dict``` – оптимизационные параметры индексации FLANN алгоритмов,
  - ```FLN_SEARCH:dict``` – оптимизационные параметры поиска FLANN алогритмов,
  - ```HOMOGRAPHY:dict``` - оптимизационные параметры определения гомографии;
- ```logfile:bool``` – способ логирования процесса выполнения:
  - ```= True``` - в файл директории ```logs/```
  - ```= False``` - в sys.stdout
- ```log:object``` – объект, реализующий логирование
- ```attempt:int``` – номер попытки выполнения

Функция ничего не возвращает, но выводит в stdout список (в дальнейшем он считывается внутри C# окружения), содержащий в себе значения смещения и поворота фрагмента относительно изображения, например:
```
[-0.1, -0.2, 3.4, 4.5, -15.0]
```
Где [0] и [1] элементы – координаты верхнего левого угла фрагмента, [2] и [3] – координаты правого нижнего угла фрагмента, и [4] элемент – его поворот с положительным значением для направления по часовой стрелке.

# logger.py
*«Система логирования»*

...

# tester.py
*«Система unit-тестирования»*

...